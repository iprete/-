<!DOCTYPE html><html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Roulette ê¸°ëŒ€ê°’ ì¡°ì •ê¸°</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>body { font-family: system-ui, sans-serif; }</style>
</head>
<body class="bg-gray-100 min-h-screen p-4">
  <div class="max-w-3xl mx-auto bg-white shadow rounded-lg overflow-hidden">
    <header class="px-6 py-4 border-b bg-white">
      <h1 class="text-2xl font-bold">Roulette ê¸°ëŒ€ê°’ ì¡°ì •ê¸°</h1>
      <p class="text-gray-600 text-sm">ê°’ ì¶”ê°€Â·ì œê±°, ê³ ì • í™•ë¥  ì„¤ì • í›„<br>"ì¶”ì²œ" â†’ í™•ë¥  ì¶”ì²œ, "ê³„ì‚°" â†’ ê¸°ëŒ“ê°’ í™•ì¸, "ì •ê·œí™”" â†’ í•© 100% ë§ì¶¤</p>
    </header>
    <main class="p-6 space-y-4">
      <div class="flex flex-wrap gap-2">
        <button id="addRow" class="px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600">ê°’ ì¶”ê°€</button>
        <button id="normBtn" class="px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600">ì •ê·œí™”</button>
        <button id="suggestBtn" class="px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600">ì¶”ì²œ</button>
        <button id="calcBtn" class="px-3 py-1 bg-indigo-500 text-white rounded hover:bg-indigo-600">ê³„ì‚°</button>
      </div>
      <section id="msg" class="text-sm"></section>
      <div class="overflow-x-auto">
        <table id="dataTable" class="w-full text-sm table-auto border-collapse">
          <thead>
            <tr class="bg-gray-200">
              <th class="border px-2 py-1">ê°’</th>
              <th class="border px-2 py-1">í™•ë¥ (%)</th>
              <th class="border px-2 py-1">ê³ ì •</th>
              <th class="border px-2 py-1">ì‚­ì œ</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="border px-2 py-1"><input type="number" value="0" class="w-20 border rounded p-1 value-cell" readonly/></td>
              <td class="border px-2 py-1"><div class="flex items-center space-x-1"><input type="number" step="0.000001" value="10.000000" class="w-20 border rounded p-1 prob-cell percent-cell"/><button type="button" class="copy-btn text-gray-500 hover:text-gray-700 text-sm" onclick="copyProb(this)">ğŸ“‹</button></div></td>
              <td class="border px-2 py-1 text-center"><input type="checkbox" class="fixed-cell" checked/></td>
              <td class="border px-2 py-1 text-center"><button class="delRow text-red-500 hover:text-red-700">âœ•</button></td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="flex gap-4">
        <div>
          <label class="block text-sm font-medium">EV ìµœì†Œ</label>
          <input type="number" id="evLow" value="4.7" step="0.1" class="border rounded p-1 w-24" />
        </div>
        <div>
          <label class="block text-sm font-medium">EV ìµœëŒ€</label>
          <input type="number" id="evHigh" value="5.0" step="0.1" class="border rounded p-1 w-24" />
        </div>
      </div>
      <div id="evDisplay" class="text-sm text-gray-700"></div>
    </main>
  </div>
  <script>
    const tbody = document.querySelector('#dataTable tbody');
    document.getElementById('addRow').addEventListener('click', () => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="border px-2 py-1"><input type="number" class="w-20 border rounded p-1 value-cell"/></td>
        <td class="border px-2 py-1"><div class="flex items-center space-x-1"><input type="number" step="0.000001" class="w-20 border rounded p-1 prob-cell percent-cell"/><button type="button" class="copy-btn text-gray-500 hover:text-gray-700 text-sm" onclick="copyProb(this)">ğŸ“‹</button></div></td>
        <td class="border px-2 py-1 text-center"><input type="checkbox" class="fixed-cell"/></td>
        <td class="border px-2 py-1 text-center"><button class="delRow text-red-500 hover:text-red-700">âœ•</button></td>
      `;
      tbody.appendChild(tr);
    });
    tbody.addEventListener('click', e => {
      if (e.target.classList.contains('delRow')) e.target.closest('tr').remove();
    });
    document.getElementById('normBtn').addEventListener('click', () => {
      showMsg('');
      const rows = [...tbody.querySelectorAll('tr')];
      let sum = 0;
      rows.forEach(tr => sum += parseFloat(tr.querySelector('.prob-cell').value) || 0);
      if (sum <= 0) { showMsg('ì •ê·œí™”í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', true); return; }
      rows.forEach(tr => {
        const cell = tr.querySelector('.prob-cell');
        const val = parseFloat(cell.value) || 0;
        cell.value = (val / sum * 100).toFixed(6);
      });
      showMsg('ì •ê·œí™” ì™„ë£Œ', false);
    });
    function showMsg(text, error=true) {
      const msg = document.getElementById('msg');
      msg.textContent = text;
      msg.style.color = error ? '#cc0000' : '#008800';
    }
    function computeGeometric(vals, p0, evLow, evHigh) {
      let lo=0.0001, hi=0.9999, best;
      const len = vals.length;
      for (let i=0; i<100; i++){
        const q=(lo+hi)/2;
        const a=(1-p0)*(1-q)/(1-Math.pow(q,len));
        let ev=0;
        vals.forEach((v,j)=> ev+=a*Math.pow(q,j)*v);
        if (ev<evLow) hi=q;
        else if (ev>evHigh) lo=q;
        else { best=q; break; }
      }
      if (!best) return null;
      const a=(1-p0)*(1-best)/(1-Math.pow(best,len));
      const probs=vals.map((_,j)=> a*Math.pow(best,j));
      return { q:best, probs };
    }
    function suggest() {
      showMsg(''); document.getElementById('evDisplay').textContent='';
      const evLow=parseFloat(document.getElementById('evLow').value);
      const evHigh=parseFloat(document.getElementById('evHigh').value);
      const rows=[...tbody.querySelectorAll('tr')];
      const fixed=[], vars=[];
      rows.forEach(tr=>{
        const v=parseFloat(tr.querySelector('.value-cell').value);
        const p=parseFloat(tr.querySelector('.prob-cell').value)/100||0;
        if (tr.querySelector('.fixed-cell').checked) fixed.push({v,p}); else vars.push(v);
      });
      const p0=fixed.find(r=>r.v===0)?.p||0;
      if (vars.length===0){ showMsg('ì¶”ì²œí•  ê°’ì´ ì—†ìŠµë‹ˆë‹¤.', true); return; }
      const geo=computeGeometric(vars, p0, evLow, evHigh);
      if (!geo){ showMsg('ì¶”ì²œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. EV ë²”ìœ„ ì¡°ì •.', true); return; }
      let idx=0;
      rows.forEach(tr=>{
        if (!tr.querySelector('.fixed-cell').checked) {
          tr.querySelector('.prob-cell').value = (geo.probs[idx++]*100).toFixed(6);
        }
      });
      showMsg('í™•ë¥  ì¶”ì²œ ì™„ë£Œ', false);
    }
    function calculate() {
      showMsg('');
      const rows=[...tbody.querySelectorAll('tr')];
      let evSum=0, pSum=0;
      rows.forEach(tr=>{
        const v=parseFloat(tr.querySelector('.value-cell').value);
        const percent=parseFloat(tr.querySelector('.prob-cell').value)||0;
        evSum += v*(percent/100);
        pSum += percent;
      });
      document.getElementById('evDisplay').textContent = `ê¸°ëŒ“ê°’ â‰ˆ ${evSum.toFixed(4)}, Î£p â‰ˆ ${pSum.toFixed(4)}%`;
    }
    function copyProb(btn) {
      const input = btn.previousElementSibling;
      const text = input.value + '%';
      navigator.clipboard.writeText(text).then(() => showMsg(`ë³µì‚¬ë¨: ${text}`, false));
    }
    document.getElementById('suggestBtn').addEventListener('click', suggest);
    document.getElementById('calcBtn').addEventListener('click', calculate);
  </script>
</body>
</html>
